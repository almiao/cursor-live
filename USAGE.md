# Cursor View 使用说明

## 基本功能

### 1. 查看聊天记录
- 启动应用后，主页面会显示所有Cursor聊天会话
- 按项目分组显示，方便查找特定项目的对话
- 支持搜索功能，可以快速找到包含特定关键词的对话

### 2. 发送消息到Cursor
- 点击任意聊天会话进入详情页面
- 在输入框中输入要发送的消息
- 点击发送按钮或按回车键发送消息
- 点击"+"按钮或按Shift+Enter创建新对话并发送消息

## 智能重启功能

### 何时会触发重启
1. **首次发送消息**：当您第一次发送消息时，系统会自动重启Cursor以确保正确的聚焦点
2. **切换项目**：当您在不同项目之间切换时，系统会重启Cursor以加载正确的项目上下文（避免重复关闭）

## 新对话功能

### 创建新对话
1. **通过按钮**：点击输入框旁边的"+"按钮
2. **通过快捷键**：在输入框中按Shift+Enter
3. **自动流程**：
   - 打开AI对话框
   - 使用Command+T创建新对话
   - 输入并发送消息
   - 获取新创建的session_id
   - 自动跳转到新对话页面

### 新对话的优势
- **独立上下文**：每个新对话都有独立的上下文
- **自动导航**：创建后自动跳转到新对话页面
- **实时刷新**：前端基于新的session_id刷新chatDetail

## 输入问题修复

### 首次输入问题
- **问题描述**：在首次输入时，输入框可能出现意外的字符（如"V"）
- **解决方案**：在打开对话框和输入文本前，自动清除输入缓冲区
- **修复措施**：
  - 在打开对话框前按ESC清除输入状态
  - 在输入文本前再次清除输入缓冲区
  - 在创建新对话后清除可能的输入

### 重启过程

#### 首次发送消息时：
1. **关闭Cursor**：
   - macOS：使用AppleScript优雅地关闭Cursor
   - Windows/Linux：使用psutil终止Cursor进程
2. **等待关闭**：等待3秒确保Cursor完全关闭
3. **重新打开**：使用AppleScript或命令行重新打开Cursor
4. **等待启动**：等待5秒确保Cursor完全启动

#### 切换项目时：
1. **关闭当前Cursor实例**：使用平台特定的方法关闭Cursor
2. **等待关闭**：等待2秒确保Cursor完全关闭
3. **打开新项目**：使用命令行打开新项目（`cursor /path/to/project`）
4. **等待启动**：等待8秒确保Cursor完全启动并加载项目
5. **发送消息时跳过激活**：避免重复操作

### 优势
- **确保聚焦点正确**：重启确保Cursor窗口处于正确的状态
- **避免上下文混乱**：每次切换项目都会重新加载，避免项目上下文混乱
- **提高发送成功率**：通过重启确保AI对话框能够正确打开

## 故障排除

### 常见问题

1. **Cursor无法关闭**
   - 确保Cursor没有正在执行重要操作
   - 手动关闭Cursor后重试

2. **Cursor无法重新打开**
   - 检查Cursor是否正确安装
   - 确保`cursor`命令在PATH中可用
   - 在macOS上，确保已授予终端访问权限

3. **消息发送失败**
   - 检查Cursor是否正在运行
   - 确保AI对话框快捷键正常工作（macOS: Command+I, Windows/Linux: Ctrl+I）
   - 检查是否有其他应用占用了快捷键

### 调试模式
如果遇到问题，可以查看服务器日志：
```bash
python3 server.py --debug
```

### 测试功能
运行测试脚本验证功能是否正常：
```bash
python3 test_cursor_restart.py
```

## 网络访问

### 自动检测局域网地址
服务器启动时会自动检测并显示局域网地址：

- **本地访问**: `http://localhost:5004` (本机访问)
- **局域网访问**: `http://192.168.x.x:5004` (同一网络的其他设备访问)

局域网IP地址会在以下位置显示：
- 服务器启动时的控制台输出
- Web界面顶部标题栏（带WiFi图标的芯片）
- API端点 `/api/server/info`

这样可以让手机或同一网络的其他电脑轻松访问。

## 系统要求

### 软件要求
- Python 3.7+
- Cursor IDE
- 现代浏览器（Chrome, Firefox, Safari, Edge）

### 依赖包
- flask>=2.0.0
- flask-cors>=3.0.10
- pyautogui>=0.9.50
- pygetwindow>=0.0.9
- pyperclip>=1.8.2
- psutil>=5.8.0

### 权限要求
- **macOS**：需要授予终端和应用的辅助功能权限
- **Windows**：需要管理员权限（用于进程管理）
- **Linux**：需要适当的权限来管理进程

## 高级配置

### 自定义快捷键
如果需要修改AI对话框的快捷键，可以编辑`pyautogu.py`文件中的相关设置。

### 调整等待时间
如果Cursor启动较慢，可以增加等待时间：
- 在`switch_cursor_project`方法中修改`time.sleep(8)`的值
- 在`send_to_cursor`方法中修改强制重启后的等待时间

### 禁用自动重启
如果不需要自动重启功能，可以在调用`receive_from_app`时设置`force_restart=False`。




